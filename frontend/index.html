<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABAplay - Nova Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" xintegrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Estilo base da fonte */
        body {
            font-family: 'Inter', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #f3f4f6; /* Fundo cinza um pouco mais claro */
        }
        /* Scrollbar customizada (Webkit) */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #e5e7eb; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }

        /* Estilos e transições para modais */
        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
            opacity: 0;
            visibility: hidden;
        }
        .modal:not(.hidden) {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            transition: transform 0.3s ease;
            transform: scale(0.95);
        }
        .modal:not(.hidden) .modal-content {
            transform: scale(1); /* Animação de entrada */
        }

        /* Estilos para botões e itens de lista */
        .assigned-program-item button { transition: all 0.2s ease; }
        .assigned-program-item button:hover { opacity: 0.8; }
        .assign-program-btn.assigned { background-color: #10b981; color: white; cursor: default; }
        .assign-program-btn.assigned:hover { background-color: #059669; }

        /* Estilos para áreas de gráfico */
        #program-progress-chart canvas,
        .consolidated-chart-wrapper canvas,
        .parent-consolidated-chart-wrapper canvas { /* Adicionado para pais */
            min-height: 200px; /* Ajustado para consistência */
            max-height: 350px; /* Ajustado para consistência */
        }
         .consolidated-chart-wrapper canvas,
         .parent-consolidated-chart-wrapper canvas { /* Adicionado para pais */
            height: 200px !important; /* Mantido para consistência do relatório */
         }


        /* --- ESTILOS DE IMPRESSÃO --- */
         @media print {
            /* Esconde elementos não desejados */
            .no-print, nav, #contextual-sidebar, #login-modal, .modal-actions, #mobile-menu,
            #consolidated-report-modal > .modal-content > div:first-child {
                display: none !important;
            }

            /* Ajusta layout geral para impressão */
            body {
                overflow: visible !important;
                height: auto !important;
                font-size: 10pt;
                background-color: white !important;
                color: black !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            #app-main-interface { display: block !important; height: auto !important; overflow: visible !important; flex-direction: column !important; }
            #main-content-area { padding: 0 !important; overflow: visible !important; background-color: white !important; }

            /* Ajusta layout do modal para ocupar a página (se for imprimir o modal de relatório) */
             .modal.print-this-modal { /* Adicionar classe 'print-this-modal' ao modal que deve ser impresso */
                position: static !important; inset: auto !important; background: none !important; display: block !important; width: 100% !important; height: auto !important; overflow: visible !important; padding: 15mm !important; box-shadow: none !important; 
             }
             .modal.print-this-modal .modal-content { 
                box-shadow: none !important; border: none !important; max-width: 100% !important; max-height: none !important; overflow: visible !important; padding: 0 !important; display: block !important; background-color: white !important; 
             }


            /* Mostra e estiliza o cabeçalho de impressão do relatório consolidado */
            #consolidated-report-print-header {
                display: block !important;
                margin-bottom: 10mm;
                padding-bottom: 5mm;
                border-bottom: 1px solid #666 !important;
                text-align: left;
            }
            #consolidated-report-print-header h2 {
                font-size: 16pt;
                font-weight: bold;
                color: #333;
                margin-bottom: 4mm;
            }
            #consolidated-report-print-header p {
                font-size: 10pt;
                color: #444;
                margin-bottom: 1mm;
            }
             #consolidated-report-print-header p span {
                 font-weight: bold;
                 color: black;
             }

            /* Layout dos gráficos para impressão (Relatório Consolidado) */
             #consolidated-charts-container { /* Usado pelo modal de relatório do terapeuta */
                 display: block !important;
                 max-height: none !important;
                 overflow: visible !important;
                 width: 100%;
                 padding: 0 !important;
                 margin-top: 5mm;
             }
             .consolidated-chart-wrapper { /* Usado pelo modal de relatório do terapeuta */
                 width: 100% !important;
                 page-break-inside: avoid !important;
                 border: 1px solid #ccc !important;
                 box-shadow: none !important;
                 background-color: #fdfdfd !important;
                 padding: 5mm !important;
                 margin-bottom: 8mm !important;
                 display: block !important;
             }
             .consolidated-chart-wrapper canvas {
                 max-height: 80mm !important;
                 width: 100% !important;
                 display: block;
                 margin: 0 auto;
             }
             .consolidated-chart-wrapper h4 {
                 font-size: 11pt;
                 font-weight: bold;
                 text-align: center;
                 margin-bottom: 4mm;
                 color: #333;
             }
             .consolidated-chart-wrapper .no-data-message {
                 font-size: 9pt;
                 text-align: center;
                 color: #666;
                 padding: 20mm 0;
             }

            /* Estilos para a view do pai na impressão */
            #parent-dashboard-view {
                padding: 15mm !important; /* Margens para impressão da view do pai */
            }
            #parent-dashboard-content h2 { /* Cabeçalho do dashboard do pai */
                font-size: 16pt;
                font-weight: bold;
                color: #333;
                margin-bottom: 8mm;
                text-align: center;
            }
            #parent-charts-grid { /* Grid de gráficos do pai */
                display: block !important; /* Garante que os gráficos não fiquem em colunas */
            }
            .parent-consolidated-chart-wrapper { /* Wrapper de cada gráfico do pai */
                width: 100% !important;
                page-break-inside: avoid !important;
                border: 1px solid #ccc !important;
                box-shadow: none !important;
                background-color: #fdfdfd !important;
                padding: 5mm !important;
                margin-bottom: 8mm !important;
                display: block !important;
            }
            .parent-consolidated-chart-wrapper canvas {
                max-height: 80mm !important; /* Ajuste a altura conforme necessário */
                width: 100% !important;
                display: block;
                margin: 0 auto;
            }
             .parent-consolidated-chart-wrapper h4 {
                 font-size: 11pt;
                 font-weight: bold;
                 text-align: center;
                 margin-bottom: 4mm;
                 color: #333;
             }
             .parent-consolidated-chart-wrapper .no-data-message {
                 font-size: 9pt;
                 text-align: center;
                 color: #666;
                 padding: 20mm 0;
             }
         }

         /* Estilos Guia de Dicas */
         #tip-guide-content h3 { font-size: 1.125rem; font-weight: 600; color: #4f46e5; margin-top: 1.5rem; margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb; }
         #tip-guide-content ul { list-style-type: none; padding-left: 0; margin-bottom: 1rem; }
         #tip-guide-content li { margin-bottom: 0.5rem; font-size: 0.875rem; color: #4b5563; }
         #tip-guide-content strong { font-weight: 600; color: #1f2937; display: inline-block; min-width: 50px; margin-right: 5px; }
         #tip-guide-content code { background-color: #f3f4f6; padding: 0.1rem 0.4rem; border-radius: 0.25rem; font-family: monospace; font-size: 0.85em; color: #374151; }
         #tip-guide-content p { font-size: 0.875rem; color: #4b5563; line-height: 1.6; margin-bottom: 1rem; }

         /* Melhoria Visual: Foco nos inputs */
         input[type="text"], input[type="password"], input[type="date"], input[type="number"], textarea {
             transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
         }
         input:focus, textarea:focus {
             border-color: #4f46e5;
             box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
         }

         /* Melhoria Visual: Botões */
         button {
             transition: background-color 0.2s ease-in-out, transform 0.1s ease;
         }
         button:active {
             transform: scale(0.98);
         }

         /* Melhoria Visual: Navegação ativa */
         .nav-link.active {
             color: #4f46e5; /* Indigo-600 */
             background-color: #eef2ff; /* Indigo-50 */
             font-weight: 600;
         }
         .nav-link:not(.active):hover {
             background-color: #f9fafb; /* Gray-50 */
         }
         /* Estilo para links ativos no menu mobile */
        #mobile-menu .nav-link-mobile.active {
            background-color: #4f46e5; /* Indigo-600 */
            color: white;
            font-weight: 600;
        }
        #mobile-menu .nav-link-mobile:not(.active):hover {
            background-color: #4338ca; /* Indigo-700 */
            color: white;
        }


         /* Melhoria Visual: Sidebar ativa */
         .client-item.active, .program-link.active, .program-category-details[open] > summary {
             background-color: #eef2ff; /* Indigo-50 */
             color: #4338ca; /* Indigo-700 */
             font-weight: 600;
         }
         .client-item:not(.active):hover, .program-link:not(.active):hover, details:not([open]) > summary:hover {
             background-color: #f9fafb; /* Gray-50 */
         }

         /* Melhoria Visual: Placeholder */
         .placeholder-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #9ca3af; /* Gray-400 */
            padding: 4rem 1rem;
            border: 2px dashed #e5e7eb; /* Gray-200 */
            border-radius: 0.5rem;
            background-color: #f9fafb; /* Gray-50 */
         }
         .placeholder-container i {
             font-size: 3rem;
             margin-bottom: 1rem;
             color: #d1d5db; /* Gray-300 */
         }
         .placeholder-container p {
             font-size: 0.875rem; /* text-sm */
             color: #6b7280; /* Gray-500 */
         }
         .placeholder-container button {
             font-size: 0.875rem; /* text-sm */
         }

         /* Ajuste Específico para Layout da Sessão */
         #session-progress-section > div {
            padding: 0;
         }
         #add-session-form {
             margin-bottom: 1.5rem; /* mb-6 */
             padding-bottom: 1.5rem; /* pb-6 */
             border-bottom: 1px solid #e5e7eb; /* border-b */
         }
         #program-progress-chart {
             margin-top: 1rem; /* mt-4 */
         }
         #program-progress-chart .relative {
             height: 16rem; /* h-64 */
         }
         @media (min-width: 768px) { /* md: */
             #program-progress-chart .relative {
                 height: 18rem; /* md:h-72 */
             }
         }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Modal de Login -->
    <div id="login-modal" class="modal hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-sm p-8 transform scale-95">
            <h2 class="text-2xl font-bold text-center text-indigo-600 mb-6 flex items-center justify-center">
                <i class="fas fa-brain mr-2 text-3xl"></i>
                <span>ABAplay</span>
            </h2>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Usuário</label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                            <i class="fas fa-user text-gray-400"></i>
                        </span>
                        <input type="text" id="username" name="username" required autofocus placeholder="Seu nome de usuário"
                               class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 text-sm shadow-sm">
                    </div>
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                     <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                            <i class="fas fa-lock text-gray-400"></i>
                        </span>
                        <input type="password" id="password" name="password" required placeholder="Sua senha"
                               class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 text-sm shadow-sm">
                    </div>
                </div>
                <div id="login-error-message" class="text-red-600 text-xs text-center h-4 font-medium"></div>
                <div>
                    <button type="submit"
                            class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 px-4 rounded-md text-sm transition duration-150 ease-in-out flex items-center justify-center space-x-2 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Entrar</span>
                    </button>
                </div>
            </form>
            <p class="text-xs text-gray-500 mt-6 text-center">
                Utilize suas credenciais registradas para acessar.
            </p>
        </div>
    </div>

    <!-- Interface Principal da Aplicação -->
    <div id="app-main-interface" class="hidden flex flex-col flex-1 overflow-hidden">
        <!-- Barra de Navegação Superior -->
        <nav class="bg-white shadow-sm w-full flex-shrink-0 z-20 no-print border-b border-gray-200">
            <div class="flex items-center justify-between px-4 sm:px-6 py-3 h-16">
                <!-- Logo e Links Desktop -->
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-indigo-600 flex items-center mr-4">
                        <i class="fas fa-brain mr-2"></i>ABAplay
                    </span>
                    <div class="hidden md:flex items-center space-x-1 ml-4">
                        <!-- Links para Terapeutas -->
                        <a href="#" class="nav-link text-gray-600 hover:text-indigo-600 font-medium px-3 py-2 rounded-md text-sm transition-colors duration-150" data-view="dashboard-view"><i class="fas fa-tachometer-alt fa-fw mr-1.5"></i> Dashboard</a>
                        <a href="#" class="nav-link text-gray-600 hover:text-indigo-600 font-medium px-3 py-2 rounded-md text-sm transition-colors duration-150 active" data-view="clients-view"><i class="fas fa-users fa-fw mr-1.5"></i> Clientes</a>
                        <a href="#" class="nav-link text-gray-600 hover:text-indigo-600 font-medium px-3 py-2 rounded-md text-sm transition-colors duration-150" data-view="programs-view" data-area="Psicologia"><i class="fas fa-folder-open fa-fw mr-1.5"></i> Psicologia</a>
                        <a href="#" class="nav-link text-gray-600 hover:text-indigo-600 font-medium px-3 py-2 rounded-md text-sm transition-colors duration-150" data-view="programs-view" data-area="TerapiaOcupacional"><i class="fas fa-puzzle-piece fa-fw mr-1.5"></i> T. Ocupacional</a>
                        <a href="#" class="nav-link text-gray-600 hover:text-indigo-600 font-medium px-3 py-2 rounded-md text-sm transition-colors duration-150" data-view="programs-view" data-area="Psicomotricidade"><i class="fas fa-child fa-fw mr-1.5"></i> Psicomotric.</a>
                        <a href="#" class="nav-link text-gray-600 hover:text-indigo-600 font-medium px-3 py-2 rounded-md text-sm transition-colors duration-150" data-view="programs-view" data-area="Psicopedagogia"><i class="fas fa-graduation-cap fa-fw mr-1.5"></i> Psicopedag.</a>
                        <a href="#" class="nav-link text-gray-600 hover:text-indigo-600 font-medium px-3 py-2 rounded-md text-sm transition-colors duration-150" data-view="programs-view" data-area="Musicoterapia"><i class="fas fa-music fa-fw mr-1.5"></i> Musicoterapia</a>
                        <a href="#" class="nav-link text-gray-600 hover:text-indigo-600 font-medium px-3 py-2 rounded-md text-sm transition-colors duration-150" data-view="programs-view" data-area="Fonoaudiologia"><i class="fas fa-comment-dots fa-fw mr-1.5"></i> Fonoaudiol.</a>
                        <a href="#" class="nav-link text-gray-600 hover:text-indigo-600 font-medium px-3 py-2 rounded-md text-sm transition-colors duration-150" data-view="notes-view"><i class="fas fa-pencil-alt fa-fw mr-1.5"></i> Anotações</a>
                        <!-- Link para Pais (será mostrado/escondido por JS) -->
                        <a href="#" class="nav-link hidden" data-view="parent-dashboard-view"><i class="fas fa-chart-line fa-fw mr-1.5"></i> Acompanhamento</a>
                        <a href="#" class="nav-link text-gray-600 hover:text-indigo-600 font-medium px-3 py-2 rounded-md text-sm transition-colors duration-150" data-view="tip-guide-view"><i class="fas fa-book-open fa-fw mr-1.5"></i> Guia de Dicas</a>
                    </div>
                </div>

                <!-- Informações do Usuário e Botão de Menu Mobile -->
                <div class="flex items-center space-x-2 sm:space-x-4">
                     <span id="current-client-indicator" class="text-xs sm:text-sm text-gray-500 italic transition-colors duration-150 hidden md:block">Nenhum cliente selecionado</span>
                     <div class="relative flex items-center space-x-2 sm:space-x-3">
                        <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-semibold text-sm border border-indigo-200" id="user-avatar" title="Usuário Logado">--</div>
                        <span class="text-gray-700 text-sm font-medium hidden lg:block" id="logged-in-username">Usuário</span>
                        <button id="logout-button" title="Sair" class="text-gray-400 hover:text-red-600 px-2 py-1 rounded-full hover:bg-gray-100 hidden md:block transition-colors duration-150">
                            <i class="fas fa-sign-out-alt fa-fw"></i>
                        </button>
                    </div>
                    <div class="md:hidden flex items-center">
                        <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 hover:text-white hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" aria-controls="mobile-menu" aria-expanded="false">
                            <span class="sr-only">Abrir menu principal</span>
                            <svg id="hamburger-icon" class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                            <svg id="close-icon" class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Menu Mobile -->
            <div class="md:hidden hidden bg-white border-t border-gray-200" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <!-- Links para Terapeutas -->
                    <a href="#" class="nav-link-mobile nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-50 hover:text-indigo-700" data-view="dashboard-view"><i class="fas fa-tachometer-alt fa-fw mr-1.5"></i> Dashboard</a>
                    <a href="#" class="nav-link-mobile nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-50 hover:text-indigo-700" data-view="clients-view"><i class="fas fa-users fa-fw mr-1.5"></i> Clientes</a>
                    <a href="#" class="nav-link-mobile nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-50 hover:text-indigo-700" data-view="programs-view" data-area="Psicologia"><i class="fas fa-folder-open fa-fw mr-1.5"></i> Psicologia</a>
                    <a href="#" class="nav-link-mobile nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-50 hover:text-indigo-700" data-view="programs-view" data-area="TerapiaOcupacional"><i class="fas fa-puzzle-piece fa-fw mr-1.5"></i> T. Ocupacional</a>
                    <a href="#" class="nav-link-mobile nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-50 hover:text-indigo-700" data-view="programs-view" data-area="Psicomotricidade"><i class="fas fa-child fa-fw mr-1.5"></i> Psicomotric.</a>
                    <a href="#" class="nav-link-mobile nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-50 hover:text-indigo-700" data-view="programs-view" data-area="Psicopedagogia"><i class="fas fa-graduation-cap fa-fw mr-1.5"></i> Psicopedag.</a>
                    <a href="#" class="nav-link-mobile nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-50 hover:text-indigo-700" data-view="programs-view" data-area="Musicoterapia"><i class="fas fa-music fa-fw mr-1.5"></i> Musicoterapia</a>
                    <a href="#" class="nav-link-mobile nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-50 hover:text-indigo-700" data-view="programs-view" data-area="Fonoaudiologia"><i class="fas fa-comment-dots fa-fw mr-1.5"></i> Fonoaudiol.</a>
                    <a href="#" class="nav-link-mobile nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-50 hover:text-indigo-700" data-view="notes-view"><i class="fas fa-pencil-alt fa-fw mr-1.5"></i> Anotações</a>
                     <!-- Link para Pais (será mostrado/escondido por JS) -->
                    <a href="#" class="nav-link-mobile nav-link hidden px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-50 hover:text-indigo-700" data-view="parent-dashboard-view"><i class="fas fa-chart-line fa-fw mr-1.5"></i> Acompanhamento</a>
                    <a href="#" class="nav-link-mobile nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-50 hover:text-indigo-700" data-view="tip-guide-view"><i class="fas fa-book-open fa-fw mr-1.5"></i> Guia de Dicas</a>
                </div>
                <div class="pt-4 pb-3 border-t border-gray-200">
                    <div class="px-3 mb-2">
                        <span id="mobile-current-client-indicator" class="block text-sm text-gray-500 italic">Nenhum cliente selecionado</span>
                    </div>
                    <div class="flex items-center px-3">
                        <div class="flex-shrink-0">
                             <div class="w-10 h-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-semibold text-base border border-indigo-200" id="mobile-user-avatar">--</div>
                        </div>
                        <div class="ml-3">
                            <div class="text-base font-medium leading-none text-gray-800" id="mobile-logged-in-username">Usuário</div>
                        </div>
                    </div>
                    <div class="mt-3 px-2 space-y-1">
                        <a href="#" id="mobile-logout-button" class="block px-3 py-2 rounded-md text-base font-medium text-gray-500 hover:bg-indigo-50 hover:text-indigo-700"><i class="fas fa-sign-out-alt fa-fw mr-1.5"></i> Sair</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Conteúdo Principal (Sidebar + Área de Conteúdo) -->
        <div class="flex flex-1 overflow-hidden">
            <!-- Sidebar Contextual -->
            <aside id="contextual-sidebar" class="w-72 bg-white border-r border-gray-200 flex-shrink-0 flex flex-col overflow-y-auto p-4 transition-all duration-300 ease-in-out no-print md:block hidden">
                <!-- Seção de Clientes (para terapeutas) -->
                <div id="sidebar-content-clients" class="sidebar-section flex flex-col flex-1">
                    <h3 class="text-base font-semibold text-gray-700 mb-3 px-1">Clientes</h3>
                    <div class="relative mb-4">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                            <i class="fas fa-search text-gray-400"></i>
                        </span>
                        <input type="text" id="client-search" placeholder="Buscar cliente..." class="w-full pl-10 pr-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 text-sm shadow-sm">
                    </div>
                    <ul id="client-list" class="space-y-1 overflow-y-auto flex-1 mb-4 -mx-2 px-2">
                        <li class="no-clients-message text-center text-gray-500 text-xs py-4 hidden">Nenhum cliente.</li>
                    </ul>
                    <div class="mt-auto border-t border-gray-200 pt-3">
                         <div id="patient-count-indicator" class="text-xs text-center text-gray-500 mb-2 hidden">Pacientes: 0 / 0</div>
                         <button id="show-add-client-form-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-md text-sm transition duration-150 ease-in-out flex items-center justify-center space-x-2 shadow-sm hover:shadow disabled:opacity-60 disabled:cursor-not-allowed" disabled>
                             <i class="fas fa-user-plus"></i>
                             <span>Novo Cliente</span>
                         </button>
                    </div>
                 </div>
                 <!-- Seção de Programas (para terapeutas) -->
                 <div id="sidebar-content-programs" class="sidebar-section hidden flex flex-col flex-1">
                     <h3 class="text-base font-semibold text-gray-700 mb-3 px-1">Biblioteca de Programas</h3>
                     <div class="relative mb-4">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                            <i class="fas fa-search text-gray-400"></i>
                        </span>
                        <input type="text" id="program-search" placeholder="Buscar programa..." class="w-full pl-10 pr-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 text-sm shadow-sm">
                     </div>
                     <div id="program-categories" class="space-y-1 overflow-y-auto flex-1 -mx-2 px-2">
                        <!-- Categorias de programas serão inseridas aqui pelo JS -->
                     </div>
                 </div>
                 <!-- Seção Guia de Dicas -->
                 <div id="sidebar-content-tip-guide" class="sidebar-section hidden">
                      <h3 class="text-base font-semibold text-gray-700 mb-3 px-1">Guia de Dicas</h3>
                      <p class="text-sm text-gray-600 px-1">Referência rápida sobre os tipos e passos de dicas.</p>
                      <!-- Conteúdo do guia pode ser adicionado aqui ou na view principal -->
                 </div>
            </aside>

            <!-- Área de Conteúdo Principal -->
            <main id="main-content-area" class="flex-1 bg-gray-100 overflow-y-auto p-4 sm:p-6">
                <!-- View: Dashboard (Geral ou do Cliente para Terapeuta) -->
                <div id="dashboard-view" class="view hidden">
                    <h1 class="text-2xl font-semibold text-gray-800 mb-6">Dashboard</h1>
                    <div id="dashboard-content" class="placeholder-container">
                        <i class="fas fa-chart-pie"></i>
                        <p>Visão geral da aplicação.</p>
                    </div>
                    <div id="client-dashboard-content" class="hidden">
                        <!-- Conteúdo do dashboard do cliente específico será inserido aqui -->
                    </div>
                </div>

                <!-- View: Clientes (para terapeutas) -->
                <div id="clients-view" class="view">
                     <!-- Painel de Adicionar/Editar Cliente -->
                     <div id="add-client-panel" class="bg-white p-6 rounded-lg shadow-md hidden mb-6 max-w-3xl mx-auto border border-gray-200">
                         <div class="flex justify-between items-center mb-5 pb-3 border-b border-gray-200">
                            <h2 class="text-xl font-semibold text-gray-800">Cadastrar Novo Cliente</h2>
                            <button id="close-add-client-panel-btn" class="text-gray-400 hover:text-gray-600 transition-colors">
                                <i class="fas fa-times text-lg"></i>
                            </button>
                         </div>
                         <form id="add-client-form" class="space-y-5">
                             <div>
                                 <label for="client-name" class="block text-sm font-medium text-gray-700 mb-1">Nome Completo <span class="text-red-500">*</span></label>
                                 <input type="text" id="client-name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 text-sm shadow-sm">
                             </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                 <div>
                                     <label for="client-dob" class="block text-sm font-medium text-gray-700 mb-1">Data de Nascimento</label>
                                     <input type="date" id="client-dob" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 text-sm shadow-sm">
                                 </div>
                                 <div>
                                     <label for="client-diagnosis" class="block text-sm font-medium text-gray-700 mb-1">Diagnóstico</label>
                                     <input type="text" id="client-diagnosis" placeholder="Ex: TEA Nível 1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 text-sm shadow-sm">
                                 </div>
                             </div>
                             <div>
                                 <label for="client-notes" class="block text-sm font-medium text-gray-700 mb-1">Anotações Iniciais</label>
                                 <textarea id="client-notes" rows="3" placeholder="Informações relevantes sobre o cliente..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 text-sm resize-vertical shadow-sm"></textarea>
                             </div>
                             <div class="text-right pt-3">
                                 <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-6 rounded-md text-sm transition duration-150 ease-in-out shadow hover:shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                     <i class="fas fa-save mr-1.5"></i> Salvar Cliente
                                 </button>
                             </div>
                         </form>
                     </div>
                     <!-- Painel de Detalhes do Cliente -->
                     <div id="client-details-panel" class="hidden">
                        <div class="bg-white p-6 rounded-lg shadow-md mb-6 border border-gray-200">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h2 id="detail-client-name" class="text-2xl font-semibold text-gray-800">Nome do Cliente</h2>
                                    <p class="text-xs text-gray-500 mt-1">ID: <span id="detail-client-id" class="font-mono"></span></p>
                                </div>
                                <div class="flex space-x-2 no-print">
                                    <button id="edit-client-btn" title="Editar Cliente" class="text-gray-500 hover:text-indigo-600 p-2 rounded-full hover:bg-gray-100 transition-colors">
                                        <i class="fas fa-edit fa-fw"></i>
                                    </button>
                                    <button id="delete-client-btn" title="Excluir Cliente" class="text-gray-500 hover:text-red-600 p-2 rounded-full hover:bg-gray-100 transition-colors">
                                        <i class="fas fa-trash-alt fa-fw"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 text-sm mb-5 border-t border-gray-100 pt-4">
                                <div><strong class="text-gray-500 font-medium block mb-0.5">Data Nasc.:</strong> <span id="detail-client-dob" class="text-gray-700"></span></div>
                                <div><strong class="text-gray-500 font-medium block mb-0.5">Diagnóstico:</strong> <span id="detail-client-diagnosis" class="text-gray-700"></span></div>
                                <div class="col-span-1 md:col-span-2"><strong class="text-gray-500 font-medium block mb-0.5">Anotações Iniciais:</strong> <span id="detail-client-notes" class="block mt-1 text-gray-700 whitespace-pre-wrap text-xs leading-relaxed"></span></div>
                            </div>
                             <div class="flex flex-wrap gap-3 border-t border-gray-100 pt-4 no-print">
                                 <button id="generate-client-grade-pdf" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-1.5 px-4 rounded-md text-xs transition duration-150 ease-in-out flex items-center space-x-1.5 border border-gray-300 shadow-sm">
                                     <i class="fas fa-file-pdf text-red-500"></i> <span>Grade PDF</span>
                                 </button>
                                 <button id="generate-client-record-pdf" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-1.5 px-4 rounded-md text-xs transition duration-150 ease-in-out flex items-center space-x-1.5 border border-gray-300 shadow-sm">
                                     <i class="fas fa-clipboard-list text-blue-500"></i> <span>Registro PDF</span>
                                 </button>
                                 <button id="generate-consolidated-report-btn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-1.5 px-4 rounded-md text-xs transition duration-150 ease-in-out flex items-center space-x-1.5 border border-gray-300 shadow-sm">
                                     <i class="fas fa-chart-pie text-green-500"></i> <span>Relatório Geral</span>
                                 </button>
                             </div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-1 bg-white p-5 rounded-lg shadow-md border border-gray-200 flex flex-col">
                                <h3 class="text-base font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-100">Programas Atribuídos</h3>
                                <ul id="assigned-programs-list" class="space-y-1 overflow-y-auto flex-1 -mx-2 px-2 max-h-[calc(100vh-400px)]">
                                    <li class="no-assigned-programs text-center text-gray-500 text-xs py-4 hidden">Nenhum programa atribuído.</li>
                                </ul>
                            </div>
                            <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md border border-gray-200">
                                <div id="session-progress-section">
                                    <div id="progress-details-area">
                                        <div class="text-center text-gray-500 py-6"> <i class="fas fa-tasks text-3xl mb-3 text-gray-400"></i>
                                            <p class="text-sm">Selecione um programa atribuído ao lado para registrar uma sessão ou ver o progresso.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                     <!-- Placeholder quando nenhum cliente está selecionado -->
                    <div id="no-client-selected-placeholder" class="placeholder-container">
                         <i class="fas fa-user-circle"></i>
                         <p>Selecione um cliente na lista ao lado para ver os detalhes.</p>
                         <p class="mt-2">Ou <button id="trigger-add-client-form-btn" class="text-indigo-600 hover:underline font-medium">cadastre um novo cliente</button>.</p>
                     </div>
                </div>

                <!-- View: Biblioteca de Programas (para terapeutas) -->
                <div id="programs-view" class="view hidden">
                     <div id="program-library-list" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5">
                         <p id="no-programs-message" class="hidden col-span-full placeholder-container">
                             <i class="fas fa-box-open"></i>
                             <span>Nenhum programa encontrado.</span>
                         </p>
                         <p id="program-view-placeholder" class="col-span-full placeholder-container">
                             <i class="fas fa-book-open"></i>
                             <span>Selecione uma categoria na barra lateral ou faça uma busca.</span>
                         </p>
                     </div>
                 </div>

                <!-- View: Anotações (para terapeutas) -->
                <div id="notes-view" class="view hidden">
                    <h1 class="text-2xl font-semibold text-gray-800 mb-6">Anotações Gerais</h1>
                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                        <div class="notes-placeholder placeholder-container mb-4">
                            <i class="fas fa-user-circle"></i>
                            <p>Selecione um cliente na barra lateral para ver ou editar as anotações.</p>
                        </div>
                        <textarea id="notes-textarea" placeholder="Anotações gerais sobre o cliente selecionado..." rows="15" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 text-sm resize-vertical shadow-sm disabled:bg-gray-50" disabled></textarea>
                        <div class="text-right mt-4">
                            <button id="save-notes-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-5 rounded-md text-sm transition disabled:opacity-60 disabled:cursor-not-allowed shadow hover:shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" disabled>
                                <i class="fas fa-save mr-1.5"></i> Salvar Anotações
                            </button>
                        </div>
                    </div>
                </div>

                <!-- View: Guia de Dicas (comum a todos) -->
                <div id="tip-guide-view" class="view hidden">
                    <h1 class="text-2xl font-semibold text-gray-800 mb-6">Guia de Dicas e Legendas</h1>
                    <div id="tip-guide-content" class="bg-white p-6 rounded-lg shadow-md max-w-3xl mx-auto border border-gray-200">
                        <p class="text-sm text-gray-600 mb-6">Este guia explica os passos de dica e as abreviações comumente usadas nos registros e programas.</p>
                        <h3>Passos das Dicas</h3>
                        <ul>
                            <li><strong>Passo 1:</strong> Imediatamente após a instrução forneça Ajuda Física Total (<code>AFT</code>).</li>
                            <li><strong>Passo 2:</strong> 1 segundo após a instrução forneça Ajuda Física Leve (<code>AFL</code>).</li>
                            <li><strong>Passo 3:</strong> 2 segundos após a instrução forneça Ajuda Gestual (<code>AG</code>).</li>
                            <li><strong>Passo 4:</strong> Independente (<code>+</code>).</li>
                        </ul>
                        <h3>Descrição das Dicas</h3>
                        <ul>
                            <li><strong><code>AFT</code>:</strong> Ajuda Física Total (guiar completamente o movimento).</li>
                            <li><strong><code>AFL</code>:</strong> Ajuda Física Leve (leve toque ou guia parcial).</li>
                            <li><strong><code>AG</code>:</strong> Ajuda Gestual (apontar, gesticular o movimento).</li>
                            <li><strong><code>+</code>:</strong> Resposta Independente (a criança realiza sem ajuda).</li>
                            <li><strong><code>-</code>:</strong> Resposta Incorreta.</li>
                            <li><strong><code>(V)</code>:</strong> Dica Verbal (instrução falada, modelo vocal).</li>
                            <li><strong><code>(Eco)</code>:</strong> Dica Ecoica (repetir parte ou toda a palavra/frase).</li>
                            <li><strong><code>(Vis)</code>:</strong> Dica Visual (mostrar figura, objeto, cartão).</li>
                            <li><strong><code>(Mod)</code>:</strong> Modelagem (demonstrar a ação correta).</li>
                             <li><strong><code>(Pos)</code>:</strong> Dica Posicional (colocar o item correto mais perto).</li>
                        </ul>
                         <h3>Avançar o Passo da Dica</h3>
                         <p>O avanço no nível de dica (diminuir a ajuda) geralmente ocorre após um número pré-definido de respostas corretas consecutivas em um determinado passo. Por exemplo, após 3 respostas corretas com <code>AFL</code>, pode-se tentar o próximo passo com <code>AG</code>. O critério exato pode variar por programa e deve ser definido pelo terapeuta responsável. O objetivo final é alcançar a independência (<code>+</code>).</p>
                         <p>O processo inverso, aumentar o nível de ajuda (Ex: de <code>AG</code> para <code>AFL</code>), ocorre após um número definido de erros consecutivos ou ausência de resposta.</p>
                    </div>
                </div>

                <!-- Nova View: Dashboard do Responsável -->
                <div id="parent-dashboard-view" class="view hidden">
                    <div id="parent-dashboard-content" class="p-4 md:p-6">
                        <!-- Conteúdo será preenchido por JS. Placeholder inicial: -->
                        <div class="text-center py-10 placeholder-container">
                            <i class="fas fa-spinner fa-spin text-3xl text-indigo-600"></i>
                            <p class="mt-2 text-gray-600">Carregando dados de progresso...</p>
                        </div>
                    </div>
                </div>
                <!-- Fim da View: Dashboard do Responsável -->

            </main>
        </div>
    </div>

    <!-- Modal de Relatório Consolidado (para terapeutas) -->
    <div id="consolidated-report-modal" class="modal hidden fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center z-50 p-4 print:p-0 print:bg-transparent print:static print:block print:shadow-none print-this-modal">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] flex flex-col overflow-hidden print:shadow-none print:rounded-none print:max-h-full print:max-w-full print:overflow-visible transform scale-95">
            <div class="flex justify-between items-center p-5 border-b border-gray-200 bg-gray-50 rounded-t-lg no-print">
                <h2 id="consolidated-report-title" class="text-lg font-semibold text-gray-800">Relatório Gráfico Consolidado</h2>
                <button class="close-modal-btn text-gray-400 hover:text-gray-700 text-2xl transition-colors">&times;</button>
            </div>
            <!-- Cabeçalho específico para impressão do relatório consolidado -->
            <div id="consolidated-report-print-header" class="hidden print:block p-5 border-b border-gray-200 mb-4">
                <h2 id="consolidated-report-print-title" class="text-xl font-semibold text-gray-800 text-center mb-1">Relatório Consolidado de Progresso</h2>
                 <p><span>Cliente:</span> <span id="consolidated-report-client-name-print"></span></p>
                <p><span>ID:</span> <span id="consolidated-report-client-id-print" class="font-mono"></span></p>
            </div>
            <div id="consolidated-charts-container" class="p-6 overflow-y-auto flex-1 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5 print:grid-cols-1 print:overflow-visible print:p-4 print:gap-6">
                <!-- Gráficos consolidados serão inseridos aqui pelo JS -->
            </div>
            <div class="modal-actions p-4 border-t border-gray-200 bg-gray-50 text-right space-x-3 rounded-b-lg no-print">
                <button id="print-consolidated-report-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-5 rounded-md text-sm transition shadow hover:shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <i class="fas fa-print mr-1.5"></i> Imprimir
                </button>
                <button id="close-consolidated-modal-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-5 rounded-md text-sm transition border border-gray-300 shadow-sm hover:shadow">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <script src="js/script.js"></script>

</body>
</html>
